// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") 
}

enum UserRole {
  Admin
  Parent
  Member
  Child
}

enum QuestStatus {
  OPEN
  ASSIGNED
  PENDING_VERIFICATION
  COMPLETED
  VOID
}

enum VerificationType {
  SIMPLE
  PHOTO_AI
  PARENT_REVIEW
}

enum QuestType {
  QUEST
  DAILY_RITUAL
}

model User {
  id            String    @id @default(uuid())
  name          String
  email         String    @unique
  password      String    // Hashed password
  role          UserRole
  stage         Int       @default(0) // 0-3 (Current Preparation Stage)
  xp_current    Int       @default(0)
  family_id     String
  family        Family    @relation(fields: [family_id], references: [id])
  assignedQuests Quest[]  @relation("AssignedQuests")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Family {
  id              String   @id @default(uuid())
  name            String
  weekly_boss_hp  Int      @default(1000)
  members         User[]
  quests          Quest[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Quest {
  id                String           @id @default(uuid())
  title             String
  category          String           // Household, Health, Learning
  status            QuestStatus      @default(OPEN)
  verification_type VerificationType @default(SIMPLE)
  proof_url         String?          // For uploaded images
  bonus_xp          Int              @default(0)
  assigned_to       String?
  assignedUser      User?            @relation("AssignedQuests", fields: [assigned_to], references: [id])
  xp_value          Int
  due_date          DateTime?
  is_secret         Boolean          @default(false)
  quest_type        QuestType        @default(QUEST)
  family_id         String
  family            Family           @relation(fields: [family_id], references: [id])
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
}

